{%- liquid
  assign sec_id = '#shopify-section-' | append: section.id
  assign columns_mobile_int = section.settings.columns_mobile | plus: 0
  assign show_mobile_slider = false
  if section.settings.swipe_on_mobile and section.blocks.size > columns_mobile_int
    assign show_mobile_slider = true
  endif
-%}

{%- style -%}
  {{ sec_id }} {
    --pc-section-padding-top: {{ section.settings.padding_top }}px;
    --pc-section-padding-bottom: {{ section.settings.padding_bottom }}px;
    --pc-columns-desktop: {{ section.settings.columns_desktop }};
    --pc-columns-mobile: {{ section.settings.columns_mobile }};
    --pc-image-width: {{ section.settings.image_width_size }}%;
    --pc-image-height: {{ section.settings.image_height }}px;
    --pc-image-border-radius: {{ section.settings.image_border_radius }}px;
    --pc-text-alignment: {{ section.settings.text_alignment }};
    --pc-paragraph-width: {{ section.settings.paragraph_width }}%;
    --pc-line-width: {{ section.settings.horizontal_line_width }}%;
    --pc-line-height: {{ section.settings.horizontal_line_height }}px;
    --pc-line-color: {{ section.settings.horizontal_line_color }};
  }

  {{ sec_id }} .pc-feature-columns {
    padding-top: var(--pc-section-padding-top);
    padding-bottom: var(--pc-section-padding-bottom);
  }

  {{ sec_id }} .pc-feature-columns__heading {
    text-align: center;
    margin-bottom: 30px;
  }

  {{ sec_id }} .pc-feature-columns__list {
    display: grid;
    grid-template-columns: repeat(var(--pc-columns-desktop), 1fr);
    gap: 30px;
    list-style: none;
    padding: 0;
    margin: 0;
  }

  {{ sec_id }} .pc-feature-column {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: var(--pc-text-alignment);
    position: relative;
  }

  {{ sec_id }} .pc-feature-column__image-wrapper {
    width: var(--pc-image-width);
    height: var(--pc-image-height);
    border-radius: var(--pc-image-border-radius);
    overflow: hidden;
    margin-bottom: 20px;
    position: relative;
  }

  {{ sec_id }} .pc-feature-column__image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: {{ section.settings.image_position }};
  }

  {{ sec_id }} .pc-feature-column__content {
    width: 100%;
  }

  {{ sec_id }} .pc-feature-column__title {
    margin: 0 0 10px;
    text-transform: uppercase;
  }

  {{ sec_id }} .pc-feature-column__text {
    width: var(--pc-paragraph-width);
    margin: 0 auto;
    line-height: 1.4;
  }

  {{ sec_id }} .pc-feature-column__link {
    display: inline-block;
    margin-top: 15px;
    text-decoration: none;
  }

  {% if section.settings.show_horizontal_line %}
  {{ sec_id }} .pc-feature-column::after {
    content: '';
    display: block;
    width: var(--pc-line-width);
    height: var(--pc-line-height);
    background: var(--pc-line-color);
    margin: 20px auto 0;
  }
  {% endif %}

  @media (max-width: 749px) {
    {{ sec_id }} .pc-feature-columns__list {
      grid-template-columns: repeat(var(--pc-columns-mobile), 1fr);
    }

    {% if show_mobile_slider %}
    {{ sec_id }} .pc-feature-columns__list {
      display: flex;
      overflow-x: auto;
      scroll-snap-type: x mandatory;
      scroll-behavior: smooth;
      -webkit-overflow-scrolling: touch;
      margin-right: -20px;
      padding-right: 20px;
    }

    {{ sec_id }} .pc-feature-column {
      scroll-snap-align: start;
      min-width: 80%;
      margin-right: 20px;
    }
    {% endif %}
  }

  {{ sec_id }} .pc-feature-columns__button {
    margin-top: 40px;
    text-align: center;
  }

  {{ sec_id }} .pc-slider-buttons {
    display: flex;
    justify-content: center;
    align-items: center;
    margin-top: 20px;
  }

  {{ sec_id }} .pc-slider-button {
    background: none;
    border: none;
    padding: 0 15px;
    cursor: pointer;
  }

  {{ sec_id }} .pc-slider-counter {
    margin: 0 10px;
  }
{%- endstyle -%}

<div class="pc-feature-columns color-{{ section.settings.color_scheme }}">
  <div class="page-width">
    {%- unless section.settings.title == blank -%}
      <div class="pc-feature-columns__heading">
        <h2 class="pc-feature-columns__title {{ section.settings.heading_size }}">
          {{ section.settings.title }}
        </h2>
      </div>
    {%- endunless -%}

    <pc-feature-columns-slider class="pc-feature-columns__slider">
      <ul class="pc-feature-columns__list" id="Slider-{{ section.id }}" role="list">
        {%- for block in section.blocks -%}
          <li
            id="Slide-{{ section.id }}-{{ forloop.index }}"
            class="pc-feature-column"
            {{ block.shopify_attributes }}
          >
            {%- if block.settings.image != blank -%}
              <div class="pc-feature-column__image-wrapper">
                {{- block.settings.image
                  | image_url: width: 800
                  | image_tag: loading: 'lazy', class: 'pc-feature-column__image'
                -}}
              </div>
            {%- else -%}
              <div class="pc-feature-column__image-wrapper">
                {{ 'product-1' | placeholder_svg_tag: 'pc-feature-column__image' }}
              </div>
            {%- endif -%}

            <div class="pc-feature-column__content">
              {%- if block.settings.title != blank -%}
                <h3 class="pc-feature-column__title" style="
                  font-size: {{ block.settings.title_font_size }}px;
                  font-weight: {{ block.settings.title_font_weight }};
                  color: {{ block.settings.title_color }};
                  text-decoration: {{ block.settings.title_text_decoration }};
                  font-style: {{ block.settings.title_font_style }};
                  padding-top: {{ block.settings.title_padding_top }}px;
                  padding-bottom: {{ block.settings.title_padding_bottom }}px;
                ">
                  {{ block.settings.title }}
                </h3>
              {%- endif -%}

              {%- if block.settings.text != blank -%}
                <div class="pc-feature-column__text rte" style="
                  font-size: {{ block.settings.text_font_size }}px;
                  font-weight: {{ block.settings.text_font_weight }};
                  color: {{ block.settings.text_color }};
                  text-decoration: {{ block.settings.text_text_decoration }};
                  font-style: {{ block.settings.text_font_style }};
                  padding-top: {{ block.settings.text_padding_top }}px;
                  padding-bottom: {{ block.settings.text_padding_bottom }}px;
                ">
                  {{ block.settings.text }}
                </div>
              {%- endif -%}

              {%- if block.settings.link_label != blank -%}
                <a
                  class="pc-feature-column__link"
                  {% if block.settings.link == blank %}
                    role="link" aria-disabled="true"
                  {% else %}
                    href="{{ block.settings.link }}"
                  {% endif %}
                >
                  {{- block.settings.link_label | escape -}}
                </a>
              {%- endif -%}
            </div>
          </li>
        {%- endfor -%}
      </ul>

      {%- if show_mobile_slider -%}
        <div class="pc-slider-buttons large-up-hide">
          <button
            type="button"
            class="pc-slider-button pc-slider-button--prev"
            name="previous"
            aria-label="{{ 'general.slider.previous_slide' | t }}"
          >
            <svg width="10" height="16" viewBox="0 0 10 16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M9 1L2 8L9 15" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </button>
          <div class="pc-slider-counter caption">
            <span class="pc-slider-counter--current">1</span>
            <span aria-hidden="true"> / </span>
            <span class="visually-hidden">{{ 'general.slider.of' | t }}</span>
            <span class="pc-slider-counter--total">{{ section.blocks.size }}</span>
          </div>
          <button
            type="button"
            class="pc-slider-button pc-slider-button--next"
            name="next"
            aria-label="{{ 'general.slider.next_slide' | t }}"
          >
            <svg width="10" height="16" viewBox="0 0 10 16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M1 1L8 8L1 15" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </button>
        </div>
      {%- endif -%}
    </pc-feature-columns-slider>

    {%- if section.settings.button_label != blank -%}
      <div class="pc-feature-columns__button">
        <a
          class="button"
          {% if section.settings.button_link == blank %}
            role="link" aria-disabled="true"
          {% else %}
            href="{{ section.settings.button_link }}"
          {% endif %}
        >
          {{ section.settings.button_label | escape }}
        </a>
      </div>
    {%- endif -%}
  </div>
</div>

<script>
class PcFeatureColumnsSlider extends HTMLElement {
  constructor() {
    super();
    this.slider = this.querySelector('.pc-feature-columns__list');
    this.sliderButtons = this.querySelectorAll('.pc-slider-button');
    this.sliderCounter = this.querySelector('.pc-slider-counter');
    
    if (!this.slider || !this.sliderButtons.length) return;
    
    this.currentIndex = 0;
    this.sliderItems = Array.from(this.slider.children);
    this.sliderItemCount = this.sliderItems.length;
    
    this.sliderButtons.forEach(button => {
      button.addEventListener('click', (e) => this.handleButtonClick(e));
    });
    
    this.updateCounter();
  }
  
  handleButtonClick(event) {
    event.preventDefault();
    const direction = event.currentTarget.classList.contains('pc-slider-button--next') ? 1 : -1;
    
    this.currentIndex = (this.currentIndex + direction + this.sliderItemCount) % this.sliderItemCount;
    this.sliderItems[this.currentIndex].scrollIntoView({
      behavior: 'smooth',
      block: 'nearest',
      inline: 'start'
    });
    
    this.updateCounter();
  }
  
  updateCounter() {
    if (!this.sliderCounter) return;
    this.sliderCounter.querySelector('.pc-slider-counter--current').textContent = this.currentIndex + 1;
  }
}

if (!customElements.get('pc-feature-columns-slider')) {
  customElements.define('pc-feature-columns-slider', PcFeatureColumnsSlider);
}
</script>

{% schema %}
{
  "name": "RW Feature Columns #1",
  "class": "section",
  "tag": "section",
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "settings": [
    {
      "type": "inline_richtext",
      "id": "title",
      "default": "Featured columns",
      "label": "Heading"
    },
    {
      "type": "select",
      "id": "heading_size",
      "options": [
        {
          "value": "h2",
          "label": "Small"
        },
        {
          "value": "h1",
          "label": "Medium"
        },
        {
          "value": "h0",
          "label": "Large"
        }
      ],
      "default": "h1",
      "label": "Heading size"
    },
    {
      "type": "header",
      "content": "Image settings"
    },
    {
      "type": "range",
      "id": "image_width_size",
      "min": 10,
      "max": 200,
      "step": 5,
      "unit": "%",
      "label": "Image width",
      "default": 100
    },
    {
      "type": "range",
      "id": "image_height",
      "min": 60,
      "max": 500,
      "step": 20,
      "unit": "px",
      "label": "Image height",
      "default": 300
    },
    {
      "type": "range",
      "id": "image_border_radius",
      "min": 0,
      "max": 100,
      "step": 2,
      "unit": "px",
      "label": "Image border radius",
      "default": 0
    },
    {
      "type": "select",
      "id": "image_position",
      "options": [
        {
          "value": "left",
          "label": "Left"
        },
        {
          "value": "center",
          "label": "Center"
        },
        {
          "value": "right",
          "label": "Right"
        }
      ],
      "default": "center",
      "label": "Image focal point"
    },
    {
      "type": "header",
      "content": "Horizontal line settings"
    },
    {
      "type": "checkbox",
      "id": "show_horizontal_line",
      "label": "Show horizontal line",
      "default": true
    },
    {
      "type": "range",
      "id": "horizontal_line_width",
      "min": 10,
      "max": 100,
      "step": 5,
      "unit": "%",
      "label": "Horizontal line width",
      "default": 80
    },
    {
      "type": "range",
      "id": "horizontal_line_height",
      "min": 1,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "Horizontal line height",
      "default": 2
    },
    {
      "type": "color",
      "id": "horizontal_line_color",
      "label": "Horizontal line color",
      "default": "#000000"
    },
    {
      "type": "header",
      "content": "Text settings"
    },
    {
      "type": "select",
      "id": "text_alignment",
      "options": [
        {
          "value": "left",
          "label": "Left"
        },
        {
          "value": "center",
          "label": "Center"
        },
        {
          "value": "right",
          "label": "Right"
        }
      ],
      "default": "center",
      "label": "Text alignment"
    },
    {
      "type": "range",
      "id": "paragraph_width",
      "min": 50,
      "max": 100,
      "step": 5,
      "unit": "%",
      "label": "Paragraph width",
      "default": 100
    },
    {
      "type": "header",
      "content": "Button"
    },
    {
      "type": "text",
      "id": "button_label",
      "default": "View all",
      "label": "Button label"
    },
    {
      "type": "url",
      "id": "button_link",
      "label": "Button link"
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "range",
      "id": "columns_desktop",
      "min": 1,
      "max": 6,
      "step": 1,
      "default": 3,
      "label": "Columns on desktop"
    },
    {
      "type": "select",
      "id": "columns_mobile",
      "options": [
        {
          "value": "1",
          "label": "1 column"
        },
        {
          "value": "2",
          "label": "2 columns"
        }
      ],
      "default": "1",
      "label": "Columns on mobile"
    },
    {
      "type": "checkbox",
      "id": "swipe_on_mobile",
      "default": false,
      "label": "Enable swipe on mobile"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "scheme-1"
    },
    {
      "type": "header",
      "content": "Section padding"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Top padding",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Bottom padding",
      "default": 36
    }
  ],
  "blocks": [
    {
      "type": "column",
      "name": "Column",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "header",
          "content": "Title settings"
        },
        {
          "type": "inline_richtext",
          "id": "title",
          "default": "Feature title",
          "label": "Title"
        },
        {
          "type": "range",
          "id": "title_font_size",
          "min": 10,
          "max": 50,
          "step": 1,
          "unit": "px",
          "label": "Title font size",
          "default": 18
        },
        {
          "type": "select",
          "id": "title_font_weight",
          "options": [
            {
              "value": "normal",
              "label": "Normal"
            },
            {
              "value": "bold",
              "label": "Bold"
            },
            {
              "value": "bolder",
              "label": "Bolder"
            },
            {
              "value": "lighter",
              "label": "Lighter"
            }
          ],
          "default": "bold",
          "label": "Title font weight"
        },
        {
          "type": "color",
          "id": "title_color",
          "label": "Title color",
          "default": "#000000"
        },
        {
          "type": "select",
          "id": "title_text_decoration",
          "options": [
            {
              "value": "none",
              "label": "None"
            },
            {
              "value": "underline",
              "label": "Underline"
            },
            {
              "value": "overline",
              "label": "Overline"
            },
            {
              "value": "line-through",
              "label": "Line through"
            }
          ],
          "default": "none",
          "label": "Title text decoration"
        },
        {
          "type": "select",
          "id": "title_font_style",
          "options": [
            {
              "value": "normal",
              "label": "Normal"
            },
            {
              "value": "italic",
              "label": "Italic"
            },
            {
              "value": "oblique",
              "label": "Oblique"
            }
          ],
          "default": "normal",
          "label": "Title font style"
        },
        {
          "type": "range",
          "id": "title_padding_top",
          "min": 0,
          "max": 50,
          "step": 1,
          "unit": "px",
          "label": "Title padding top",
          "default": 0
        },
        {
          "type": "range",
          "id": "title_padding_bottom",
          "min": 0,
          "max": 50,
          "step": 1,
          "unit": "px",
          "label": "Title padding bottom",
          "default": 10
        },
        {
          "type": "header",
          "content": "Text settings"
        },
        {
          "type": "richtext",
          "id": "text",
          "default": "<p>Feature description</p>",
          "label": "Text"
        },
        {
          "type": "range",
          "id": "text_font_size",
          "min": 10,
          "max": 30,
          "step": 1,
          "unit": "px",
          "label": "Text font size",
          "default": 14
        },
        {
          "type": "select",
          "id": "text_font_weight",
          "options": [
            {
              "value": "normal",
              "label": "Normal"
            },
            {
              "value": "bold",
              "label": "Bold"
            },
            {
              "value": "bolder",
              "label": "Bolder"
            },
            {
              "value": "lighter",
              "label": "Lighter"
            }
          ],
          "default": "normal",
          "label": "Text font weight"
        },
        {
          "type": "color",
          "id": "text_color",
          "label": "Text color",
          "default": "#000000"
        },
        {
          "type": "select",
          "id": "text_text_decoration",
          "options": [
            {
              "value": "none",
              "label": "None"
            },
            {
              "value": "underline",
              "label": "Underline"
            },
            {
              "value": "overline",
              "label": "Overline"
            },
            {
              "value": "line-through",
              "label": "Line through"
            }
          ],
          "default": "none",
          "label": "Text text decoration"
        },
        {
          "type": "select",
          "id": "text_font_style",
          "options": [
            {
              "value": "normal",
              "label": "Normal"
            },
            {
              "value": "italic",
              "label": "Italic"
            },
            {
              "value": "oblique",
              "label": "Oblique"
            }
          ],
          "default": "normal",
          "label": "Text font style"
        },
        {
          "type": "range",
          "id": "text_padding_top",
          "min": 0,
          "max": 50,
          "step": 1,
          "unit": "px",
          "label": "Text padding top",
          "default": 0
        },
        {
          "type": "range",
          "id": "text_padding_bottom",
          "min": 0,
          "max": 50,
          "step": 1,
          "unit": "px",
          "label": "Text padding bottom",
          "default": 0
        },
        {
          "type": "header",
          "content": "Link"
        },
        {
          "type": "text",
          "id": "link_label",
          "label": "Link label"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Link"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "RW Feature Columns #1",
      "blocks": [
        {
          "type": "column",
          "settings": {
            "title": "CLICK AND COLLECT",
            "text": "<p>Just 10% deposit. Pay the rest on collection. Same price online & instore!</p>"
          }
        },
        {
          "type": "column",
          "settings": {
            "title": "WE SHIP WORLDWIDE",
            "text": "<p>Competitive prices in the EU & selected countries worldwide.</p>"
          }
        },
        {
          "type": "column",
          "settings": {
            "title": "OVER 20,000 PRODUCTS",
            "text": "<p>In stock at our store and warehouse, ready to ship directly to you!</p>"
          }
        }
      ]
    }
  ]
}
{% endschema %}