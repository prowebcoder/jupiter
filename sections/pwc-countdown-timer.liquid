

{%- style -%}
.countdown-timer-section {
  position: relative;
  margin: 0 auto;
  padding: 40px 0;
  max-width: 1200px;
  text-align: center;
  font-family: Arial, sans-serif;
}

.countdown-timer-section h1 {
  margin-bottom: 60px;
  font-weight: bold;
  font-size: 2.5em;
  text-transform: uppercase;
  letter-spacing: 2px;
}

.countdown-timer-section h1 strong {
  color: {{ section.settings.highlight_color }};
}

.countdown {
  display: flex;
  justify-content: center;
  gap: 30px;
  margin: 0 auto;
}

.bloc-time {
  display: flex;
  flex-direction: column;
  align-items: center;
  min-width: 120px;
}

.count-title {
  display: block;
  margin-bottom: 15px;
  font-weight: bold;
  font-size: 1.2em;
  text-transform: uppercase;
  letter-spacing: 1px;
}

.figure-container {
  display: flex;
  gap: 5px;
}

.figure {
  position: relative;
  height: 80px;
  width: 50px;
  background-color: {{ section.settings.background_color }};
  border: 1px solid {{ section.settings.border_color }};
  border-radius: 5px;
  overflow: hidden;
}

.figure .digit {
  position: absolute;
  left: 0;
  right: 0;
  margin: auto;
  font-family: 'Arial', sans-serif;
  font-size: 3.5em;
  line-height: 80px;
  font-weight: bold;
  color: {{ section.settings.digit_color }};
  text-align: center;
}

.figure .top {
  position: absolute;
  top: 0;
  width: 100%;
  height: 50%;
  background-color: {{ section.settings.top_section_color }};
  display: flex;
  align-items: flex-end;
  justify-content: center;
  overflow: hidden;
  z-index: 2;
  border-bottom: 1px solid {{ section.settings.border_color }};
}

.figure .bottom {
  position: absolute;
  bottom: 0;
  width: 100%;
  height: 50%;
  display: flex;
  align-items: flex-start;
  justify-content: center;
  overflow: hidden;
  z-index: 1;
}

.figure .top-back {
  position: absolute;
  top: 0;
  width: 100%;
  height: 50%;
  display: flex;
  align-items: flex-end;
  justify-content: center;
  overflow: hidden;
  z-index: 3;
  transform-origin: bottom;
  transform: rotateX(0deg);
}

.figure .bottom-back {
  position: absolute;
  bottom: 0;
  width: 100%;
  height: 50%;
  display: flex;
  align-items: flex-start;
  justify-content: center;
  overflow: hidden;
  z-index: 1;
  background-color: {{ section.settings.background_color }};
}

/* Animation classes */
.flipping .top {
  transform: rotateX(-90deg);
  transition: transform 0.6s ease;
}

.flipping .top-back {
  transform: rotateX(0deg);
  transition: transform 0.6s ease 0.3s;
}

@media (max-width: 767px) {
  .countdown {
    flex-direction: column;
    align-items: center;
    gap: 20px;
  }
  
  .figure {
    height: 60px;
    width: 40px;
  }
  
  .figure .digit {
    font-size: 2.5em;
    line-height: 60px;
  }
}
{%- endstyle -%}

<div class="countdown-timer-section">
  <h1>{{ section.settings.title }} <strong>{{ section.settings.highlighted_text }}</strong></h1>
  
  <div class="countdown">
    <div class="bloc-time hours" data-init-value="{{ section.settings.hours }}">
      <span class="count-title">HOURS</span>
      <div class="figure-container">
        <div class="figure hours-1">
          <span class="digit top">{{ section.settings.hours | slice: 0 }}</span>
          <span class="digit top-back">{{ section.settings.hours | slice: 0 }}</span>
          <span class="digit bottom">{{ section.settings.hours | slice: 0 }}</span>
          <span class="digit bottom-back">{{ section.settings.hours | slice: 0 }}</span>
        </div>
        <div class="figure hours-2">
          <span class="digit top">{{ section.settings.hours | slice: 1 }}</span>
          <span class="digit top-back">{{ section.settings.hours | slice: 1 }}</span>
          <span class="digit bottom">{{ section.settings.hours | slice: 1 }}</span>
          <span class="digit bottom-back">{{ section.settings.hours | slice: 1 }}</span>
        </div>
      </div>
    </div>
    
    <div class="bloc-time min" data-init-value="{{ section.settings.minutes }}">
      <span class="count-title">MINUTES</span>
      <div class="figure-container">
        <div class="figure min-1">
          <span class="digit top">{{ section.settings.minutes | slice: 0 }}</span>
          <span class="digit top-back">{{ section.settings.minutes | slice: 0 }}</span>
          <span class="digit bottom">{{ section.settings.minutes | slice: 0 }}</span>
          <span class="digit bottom-back">{{ section.settings.minutes | slice: 0 }}</span>
        </div>
        <div class="figure min-2">
          <span class="digit top">{{ section.settings.minutes | slice: 1 }}</span>
          <span class="digit top-back">{{ section.settings.minutes | slice: 1 }}</span>
          <span class="digit bottom">{{ section.settings.minutes | slice: 1 }}</span>
          <span class="digit bottom-back">{{ section.settings.minutes | slice: 1 }}</span>
        </div>
      </div>
    </div>
    
    <div class="bloc-time sec" data-init-value="{{ section.settings.seconds }}">
      <span class="count-title">SECONDS</span>
      <div class="figure-container">
        <div class="figure sec-1">
          <span class="digit top">{{ section.settings.seconds | slice: 0 }}</span>
          <span class="digit top-back">{{ section.settings.seconds | slice: 0 }}</span>
          <span class="digit bottom">{{ section.settings.seconds | slice: 0 }}</span>
          <span class="digit bottom-back">{{ section.settings.seconds | slice: 0 }}</span>
        </div>
        <div class="figure sec-2">
          <span class="digit top">{{ section.settings.seconds | slice: 1 }}</span>
          <span class="digit top-back">{{ section.settings.seconds | slice: 1 }}</span>
          <span class="digit bottom">{{ section.settings.seconds | slice: 1 }}</span>
          <span class="digit bottom-back">{{ section.settings.seconds | slice: 1 }}</span>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const Countdown = {
    init: function() {
      this.$ = {
        hours: document.querySelectorAll('.bloc-time.hours .figure'),
        minutes: document.querySelectorAll('.bloc-time.min .figure'),
        seconds: document.querySelectorAll('.bloc-time.sec .figure')
      };
      
      this.values = {
        hours: parseInt(document.querySelector('.bloc-time.hours').getAttribute('data-init-value')),
        minutes: parseInt(document.querySelector('.bloc-time.min').getAttribute('data-init-value')),
        seconds: parseInt(document.querySelector('.bloc-time.sec').getAttribute('data-init-value'))
      };
      
      this.total_seconds = this.values.hours * 60 * 60 + (this.values.minutes * 60) + this.values.seconds;
      
      // Initialize display
      this.updateDisplay();
      this.count();
    },
    
    count: function() {
      const that = this;
      
      this.countdown_interval = setInterval(function() {
        if(that.total_seconds > 0) {
          --that.values.seconds;
          
          if(that.values.minutes >= 0 && that.values.seconds < 0) {
            that.values.seconds = 59;
            --that.values.minutes;
          }
          
          if(that.values.hours >= 0 && that.values.minutes < 0) {
            that.values.minutes = 59;
            --that.values.hours;
          }
          
          that.updateDisplay();
          --that.total_seconds;
        } else {
          clearInterval(that.countdown_interval);
        }
      }, 1000);
    },
    
    animateFigure: function(el, newValue) {
      const top = el.querySelector('.top');
      const bottom = el.querySelector('.bottom');
      const topBack = el.querySelector('.top-back');
      const bottomBack = el.querySelector('.bottom-back');
      
      if (top.textContent !== newValue) {
        // Set the back values first
        topBack.textContent = newValue;
        bottomBack.textContent = newValue;
        
        // Add animation class
        el.classList.add('flipping');
        
        // After animation completes
        setTimeout(function() {
          top.textContent = newValue;
          bottom.textContent = newValue;
          el.classList.remove('flipping');
        }, 600);
      }
    },
    
    updateDisplay: function() {
      // Format values to always be 2 digits
      const hoursStr = this.values.hours.toString().padStart(2, '0');
      const minutesStr = this.values.minutes.toString().padStart(2, '0');
      const secondsStr = this.values.seconds.toString().padStart(2, '0');
      
      // Update hours
      this.animateFigure(this.$.hours[0], hoursStr[0]);
      this.animateFigure(this.$.hours[1], hoursStr[1]);
      
      // Update minutes
      this.animateFigure(this.$.minutes[0], minutesStr[0]);
      this.animateFigure(this.$.minutes[1], minutesStr[1]);
      
      // Update seconds
      this.animateFigure(this.$.seconds[0], secondsStr[0]);
      this.animateFigure(this.$.seconds[1], secondsStr[1]);
    }
  };
  
  Countdown.init();
});
</script>
{%- schema -%}
{
  "name": "Countdown Timer",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Heading",
      "default": "DRAFT COUNTDOWN"
    },
    {
      "type": "text",
      "id": "highlighted_text",
      "label": "Highlighted Text",
      "default": "COUNTDOWN"
    },
    {
      "type": "color",
      "id": "highlight_color",
      "label": "Highlight Color",
      "default": "#000000"
    },
    {
      "type": "header",
      "content": "Countdown Settings"
    },
    {
      "type": "range",
      "id": "hours",
      "label": "Hours",
      "min": 0,
      "max": 99,
      "step": 1,
      "default": 22
    },
    {
      "type": "range",
      "id": "minutes",
      "label": "Minutes",
      "min": 0,
      "max": 59,
      "step": 1,
      "default": 33
    },
    {
      "type": "range",
      "id": "seconds",
      "label": "Seconds",
      "min": 0,
      "max": 59,
      "step": 1,
      "default": 55
    },
    {
      "type": "header",
      "content": "Style Settings"
    },
    {
      "type": "color",
      "id": "digit_color",
      "label": "Digit Color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background Color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "top_section_color",
      "label": "Top Section Color",
      "default": "#f5f5f5"
    },
    {
      "type": "color",
      "id": "border_color",
      "label": "Border Color",
      "default": "#e0e0e0"
    }
  ],
  "presets": [
    {
      "name": "Countdown Timer",
      "category": "Promotional"
    }
  ]
}
{%- endschema -%}