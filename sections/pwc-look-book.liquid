{%- assign sec_id = '#shopify-section-' | append: section.id -%}
{%- assign parts = sec_id | split: '_' -%}
{%- assign last_lower = parts | last -%}
{%- assign last_part = last_lower | downcase -%}

{% style %}
  /* Reset and base styles */
  {{ sec_id }} {
    box-sizing: border-box;
  }

  {{ sec_id }} *,
  {{ sec_id }} *::before,
  {{ sec_id }} *::after {
    box-sizing: inherit;
  }

  {{ sec_id }} .pc-lookbook-{{ last_part }} {
    padding: {{ section.settings.desktop_padding_top }}px {{ section.settings.desktop_padding_right }}px {{ section.settings.desktop_padding_bottom }}px {{ section.settings.desktop_padding_left }}px;
    max-width: 1400px;
    margin: 0 auto;
    position: relative;
    width: 100%;
  }

  /* Slider container */
  {{ sec_id }} .pc-lookbook-slider-container-{{ last_part }} {
    position: relative;
    width: 100%;
    overflow: hidden;
  }

  /* Main slider */
  {{ sec_id }} .pc-lookbook-slider-{{ last_part }} {
    display: flex;
    width: 100%;
    transition: transform 0.5s ease;
    will-change: transform;
  }

  {{ sec_id }} .pc-lookbook-item-{{ last_part }} {
    flex: 0 0 100%;
    min-width: 100%;
    display: flex;
    min-height: 500px;
  }

  /* Arrows */
  {{ sec_id }} .pc-slider-arrows-{{ last_part }} {
    position: absolute;
    width: 100%;
    top: 50%;
    left: 0;
    transform: translateY(-50%);
    display: flex;
    justify-content: space-between;
    pointer-events: none;
    z-index: 10;
  }

  {{ sec_id }} .pc-slider-arrow-{{ last_part }} {
    pointer-events: auto;
    background: rgba(255, 255, 255, 0.8);
    border: none;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  }

  {{ sec_id }} .pc-slider-arrow-{{ last_part }}:hover {
    background: #000;
  }

  {{ sec_id }} .pc-slider-arrow-{{ last_part }}:hover svg {
    stroke: #fff;
  }

  {{ sec_id }} .pc-slider-arrow-{{ last_part }} svg {
    width: 20px;
    height: 20px;
    stroke: #000;
    stroke-width: 2;
  }

  /* Layout */
  {{ sec_id }} .pc-lookbook-image-container-{{ last_part }} {
    width: 50%;
    padding-right: 15px;
    position: relative;
  }

  {{ sec_id }} .pc-lookbook-products-{{ last_part }} {
    width: 50%;
    padding-left: 15px;
    display: flex;
    align-items: center;
  }

  {{ sec_id }} .pc-lookbook-image-{{ last_part }} {
    position: relative;
    height: 100%;
    width: 100%;
  }

  {{ sec_id }} .pc-lookbook-image-{{ last_part }} img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }

  /* Product slider */
  {{ sec_id }} .pc-product-slider-container-{{ last_part }} {
    height: 100%;
    position: relative;
    width: 100%;
  }

  {{ sec_id }} .pc-product-slider-{{ last_part }} {
    display: flex;
    width: 100%;
    height: 100%;
    transition: transform 0.5s ease;
  }

  {{ sec_id }} .pc-product-slide-{{ last_part }} {
    flex: 0 0 100%;
    min-width: 100%;
    padding: 20px;
  }

  /* Hotspots */
  {{ sec_id }} .pc-hotspot-{{ last_part }} {
    position: absolute;
    transform: translate(-50%, -50%);
    cursor: pointer;
    z-index: 5;
  }

  {{ sec_id }} .pc-hotspot-marker-{{ last_part }} {
    width: 24px;
    height: 24px;
    background: rgba(255, 255, 255, 0.8);
    border: 2px solid #000;
    border-radius: 50%;
    position: relative;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  {{ sec_id }} .pc-hotspot-marker-{{ last_part }}:after {
    content: '';
    width: 12px;
    height: 12px;
    background: #000;
    border-radius: 50%;
  }

  {{ sec_id }} .pc-hotspot-{{ last_part }}.active .pc-hotspot-marker-{{ last_part }},
  {{ sec_id }} .pc-hotspot-{{ last_part }}:hover .pc-hotspot-marker-{{ last_part }} {
    transform: scale(1.3);
    background: #000;
  }

  {{ sec_id }} .pc-hotspot-{{ last_part }}.active .pc-hotspot-marker-{{ last_part }}:after,
  {{ sec_id }} .pc-hotspot-{{ last_part }}:hover .pc-hotspot-marker-{{ last_part }}:after {
    background: #fff;
  }

  /* Navigation */
  {{ sec_id }} .pc-slider-nav-{{ last_part }} {
    display: flex;
    justify-content: center;
    margin-top: 30px;
  }

  {{ sec_id }} .pc-slider-dot-{{ last_part }} {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: #ddd;
    margin: 0 5px;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  {{ sec_id }} .pc-slider-dot-{{ last_part }}.active {
    background: #000;
    transform: scale(1.2);
  }

  {{ sec_id }} .pc-lookbook-dots-{{ last_part }} {
    display: flex;
    justify-content: center;
    margin-top: 20px;
  }

  /* Mobile styles */
  @media (max-width: 768px) {
    {{ sec_id }} .pc-lookbook-{{ last_part }} {
      padding: {{ section.settings.mobile_padding_top }}px {{ section.settings.mobile_padding_right }}px {{ section.settings.mobile_padding_bottom }}px {{ section.settings.mobile_padding_left }}px;
    }

    {{ sec_id }} .pc-lookbook-item-{{ last_part }} {
      flex-direction: column;
      min-height: auto;
    }

    {{ sec_id }} .pc-lookbook-image-container-{{ last_part }},
    {{ sec_id }} .pc-lookbook-products-{{ last_part }} {
      width: 100%;
      padding: 0;
    }

    {{ sec_id }} .pc-lookbook-image-{{ last_part }} {
      height: 400px;
    }

    {{ sec_id }} .pc-lookbook-products-{{ last_part }} {
      margin-top: 30px;
      min-height: 300px;
    }

    {{ sec_id }} .pc-slider-arrow-{{ last_part }} {
      width: 30px;
      height: 30px;
    }
  }
{% endstyle %}

<div class="pc-lookbook-{{ last_part }}">
  <h2 class="pc-section-title-{{ last_part }}">{{ section.settings.title }}</h2>

  <div class="pc-lookbook-slider-container-{{ last_part }}">
    <div class="pc-slider-arrows-{{ last_part }}">
      <button class="pc-slider-arrow-{{ last_part }} pc-slider-arrow-prev-{{ last_part }}" aria-label="Previous look">
        <svg viewBox="0 0 24 24" fill="none">
          <path d="M15 18L9 12L15 6" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
      <button class="pc-slider-arrow-{{ last_part }} pc-slider-arrow-next-{{ last_part }}" aria-label="Next look">
        <svg viewBox="0 0 24 24" fill="none">
          <path d="M9 6L15 12L9 18" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </div>

    <div class="pc-lookbook-slider-{{ last_part }}">
      {% for block in section.blocks %}
        <div class="pc-lookbook-item-{{ last_part }}" data-index="{{ forloop.index0 }}">
          <div class="pc-lookbook-image-container-{{ last_part }}">
            {% if block.settings.image != blank %}
              <div class="pc-lookbook-image-{{ last_part }}">
                {{
                  block.settings.image
                  | image_url: width: 1000
                  | image_tag: loading: 'lazy', alt: block.settings.image.alt, class: 'pc-lookbook-img'
                }}

                {% if block.settings.hotspot_1_product != blank %}
                  <div
                    class="pc-hotspot-{{ last_part }} {% if forloop.first %}active{% endif %}"
                    style="left: {{ block.settings.hotspot_1_x }}%; top: {{ block.settings.hotspot_1_y }}%;"
                    data-slide-index="0"
                  >
                    <div class="pc-hotspot-marker-{{ last_part }}"></div>
                  </div>
                {% endif %}

                {% if block.settings.hotspot_2_product != blank %}
                  <div
                    class="pc-hotspot-{{ last_part }}"
                    style="left: {{ block.settings.hotspot_2_x }}%; top: {{ block.settings.hotspot_2_y }}%;"
                    data-slide-index="1"
                  >
                    <div class="pc-hotspot-marker-{{ last_part }}"></div>
                  </div>
                {% endif %}

                {% if block.settings.hotspot_3_product != blank %}
                  <div
                    class="pc-hotspot-{{ last_part }}"
                    style="left: {{ block.settings.hotspot_3_x }}%; top: {{ block.settings.hotspot_3_y }}%;"
                    data-slide-index="2"
                  >
                    <div class="pc-hotspot-marker-{{ last_part }}"></div>
                  </div>
                {% endif %}
              </div>
            {% else %}
              <div class="pc-lookbook-image-{{ last_part }}">
                {{ 'product-1' | placeholder_svg_tag: 'pc-lookbook-placeholder' }}
              </div>
            {% endif %}
          </div>

          <div class="pc-lookbook-products-{{ last_part }}">
            <div class="pc-product-slider-container-{{ last_part }}">
              <div class="pc-product-slider-{{ last_part }}" id="product-slider-{{ block.id }}">
                {% if block.settings.hotspot_1_product != blank %}
                  {% assign product = all_products[block.settings.hotspot_1_product] %}
                  <div class="pc-product-slide-{{ last_part }}">
                    <div class="pc-product-card-{{ last_part }}">
                      <div class="pc-product-card-image-{{ last_part }}">
                        <a href="{{ product.url }}">
                          {{
                            product.featured_image
                            | image_url: width: 400
                            | image_tag: loading: 'lazy', alt: product.title, class: 'pc-product-img'
                          }}
                        </a>
                      </div>
                      <div class="pc-product-card-info-{{ last_part }}">
                        <h3>
                          <a href="{{ product.url }}">{{ product.title }}</a>
                        </h3>
                        <p>{{ product.price | money }}</p>
                      </div>
                    </div>
                  </div>
                {% endif %}

                {% if block.settings.hotspot_2_product != blank %}
                  {% assign product = all_products[block.settings.hotspot_2_product] %}
                  <div class="pc-product-slide-{{ last_part }}">
                    <div class="pc-product-card-{{ last_part }}">
                      <div class="pc-product-card-image-{{ last_part }}">
                        <a href="{{ product.url }}">
                          {{
                            product.featured_image
                            | image_url: width: 400
                            | image_tag: loading: 'lazy', alt: product.title, class: 'pc-product-img'
                          }}
                        </a>
                      </div>
                      <div class="pc-product-card-info-{{ last_part }}">
                        <h3>
                          <a href="{{ product.url }}">{{ product.title }}</a>
                        </h3>
                        <p>{{ product.price | money }}</p>
                      </div>
                    </div>
                  </div>
                {% endif %}

                {% if block.settings.hotspot_3_product != blank %}
                  {% assign product = all_products[block.settings.hotspot_3_product] %}
                  <div class="pc-product-slide-{{ last_part }}">
                    <div class="pc-product-card-{{ last_part }}">
                      <div class="pc-product-card-image-{{ last_part }}">
                        <a href="{{ product.url }}">
                          {{
                            product.featured_image
                            | image_url: width: 400
                            | image_tag: loading: 'lazy', alt: product.title, class: 'pc-product-img'
                          }}
                        </a>
                      </div>
                      <div class="pc-product-card-info-{{ last_part }}">
                        <h3>
                          <a href="{{ product.url }}">{{ product.title }}</a>
                        </h3>
                        <p>{{ product.price | money }}</p>
                      </div>
                    </div>
                  </div>
                {% endif %}
              </div>

              <div class="pc-slider-nav-{{ last_part }}">
                {% if block.settings.hotspot_1_product != blank %}
                  <div class="pc-slider-dot-{{ last_part }} active" data-slide-index="0"></div>
                {% endif %}
                {% if block.settings.hotspot_2_product != blank %}
                  <div class="pc-slider-dot-{{ last_part }}" data-slide-index="1"></div>
                {% endif %}
                {% if block.settings.hotspot_3_product != blank %}
                  <div class="pc-slider-dot-{{ last_part }}" data-slide-index="2"></div>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  </div>

  <div class="pc-lookbook-dots-{{ last_part }}">
    {% for block in section.blocks %}
      <div
        class="pc-slider-dot-{{ last_part }} {% if forloop.first %}active{% endif %}"
        data-index="{{ forloop.index0 }}"
      ></div>
    {% endfor %}
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const section = document.querySelector('{{ sec_id }}');
  if (!section) return;

  const lastPart = '{{ last_part }}';
  const slider = section.querySelector(`.pc-lookbook-slider-${lastPart}`);
  const slides = section.querySelectorAll(`.pc-lookbook-item-${lastPart}`);
  const dots = section.querySelectorAll(`.pc-lookbook-dots-${lastPart} .pc-slider-dot-${lastPart}`);
  const prevBtn = section.querySelector(`.pc-slider-arrow-prev-${lastPart}`);
  const nextBtn = section.querySelector(`.pc-slider-arrow-next-${lastPart}`);

  if (!slider || !slides.length) return;

  let currentIndex = 0;
  const slideCount = slides.length;
  let isAnimating = false;

  // Initialize sliders for each lookbook item
  slides.forEach((slide, index) => {
    const productSlider = slide.querySelector(`.pc-product-slider-${lastPart}`);
    const productSlides = slide.querySelectorAll(`.pc-product-slide-${lastPart}`);
    const productDots = slide.querySelectorAll(`.pc-slider-nav-${lastPart} .pc-slider-dot-${lastPart}`);
    const hotspots = slide.querySelectorAll(`.pc-hotspot-${lastPart}`);

    if (!productSlider || !productSlides.length) return;

    let currentProductIndex = 0;

    // Function to go to specific product slide
    function goToProductSlide(index) {
      if (isAnimating || index < 0 || index >= productSlides.length) return;
      
      isAnimating = true;
      currentProductIndex = index;
      
      productSlider.style.transform = `translateX(-${index * 100}%)`;
      
      // Update active states
      productDots.forEach(dot => dot.classList.remove('active'));
      hotspots.forEach(hotspot => hotspot.classList.remove('active'));
      
      if (productDots[index]) productDots[index].classList.add('active');
      if (hotspots[index]) hotspots[index].classList.add('active');
      
      setTimeout(() => {
        isAnimating = false;
      }, 500);
    }

    // Add click handlers for product dots
    productDots.forEach(dot => {
      dot.addEventListener('click', function() {
        const slideIndex = parseInt(this.dataset.slideIndex);
        goToProductSlide(slideIndex);
      });
    });

    // Add click handlers for hotspots
    hotspots.forEach(hotspot => {
      hotspot.addEventListener('click', function() {
        const slideIndex = parseInt(this.dataset.slideIndex);
        goToProductSlide(slideIndex);
      });
    });

    // Initialize first product slide
    if (productDots.length > 0) {
      productDots[0].classList.add('active');
    }
    if (hotspots.length > 0) {
      hotspots[0].classList.add('active');
    }
  });

  // Function to go to specific lookbook slide
  function goToSlide(index) {
    if (isAnimating || index < 0 || index >= slideCount) return;
    
    isAnimating = true;
    currentIndex = index;
    
    slider.style.transform = `translateX(-${index * 100}%)`;
    
    // Update active states
    dots.forEach(dot => dot.classList.remove('active'));
    if (dots[index]) dots[index].classList.add('active');
    
    setTimeout(() => {
      isAnimating = false;
    }, 500);
  }

  // Add click handlers for main dots
  dots.forEach(dot => {
    dot.addEventListener('click', function() {
      const slideIndex = parseInt(this.dataset.index);
      goToSlide(slideIndex);
    });
  });

  // Add click handlers for arrows
  if (prevBtn) {
    prevBtn.addEventListener('click', function() {
      goToSlide(currentIndex - 1);
    });
  }

  if (nextBtn) {
    nextBtn.addEventListener('click', function() {
      goToSlide(currentIndex + 1);
    });
  }

  // Initialize first slide
  if (dots.length > 0) {
    dots[0].classList.add('active');
  }
});
</script>

{% schema %}
{
  "name": "PWC - Lookbook #1",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Section Title",
      "default": "Look Book"
    },
    {
      "type": "header",
      "content": "Title Styling"
    },
    {
      "type": "range",
      "id": "title_font_size",
      "label": "Font Size (Desktop)",
      "min": 12,
      "max": 72,
      "step": 1,
      "unit": "px",
      "default": 32
    },
    {
      "type": "range",
      "id": "mobile_title_font_size",
      "label": "Font Size (Mobile)",
      "min": 12,
      "max": 48,
      "step": 1,
      "unit": "px",
      "default": 24
    },
    {
      "type": "color",
      "id": "title_color",
      "label": "Title Color",
      "default": "#000000"
    },
    {
      "type": "select",
      "id": "title_alignment",
      "label": "Title Alignment",
      "options": [
        {
          "value": "left",
          "label": "Left"
        },
        {
          "value": "center",
          "label": "Center"
        },
        {
          "value": "right",
          "label": "Right"
        }
      ],
      "default": "center"
    },
    {
      "type": "range",
      "id": "title_font_weight",
      "label": "Font Weight",
      "min": 300,
      "max": 900,
      "step": 100,
      "default": 600
    },
    {
      "type": "range",
      "id": "title_margin_bottom",
      "label": "Title Margin Bottom (Desktop)",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "default": 30
    },
    {
      "type": "range",
      "id": "mobile_title_margin_bottom",
      "label": "Title Margin Bottom (Mobile)",
      "min": 0,
      "max": 60,
      "step": 5,
      "unit": "px",
      "default": 20
    },
    {
      "type": "header",
      "content": "Desktop Padding"
    },
    {
      "type": "range",
      "id": "desktop_padding_top",
      "label": "Top Padding",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "default": 50
    },
    {
      "type": "range",
      "id": "desktop_padding_right",
      "label": "Right Padding",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "default": 20
    },
    {
      "type": "range",
      "id": "desktop_padding_bottom",
      "label": "Bottom Padding",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "default": 50
    },
    {
      "type": "range",
      "id": "desktop_padding_left",
      "label": "Left Padding",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "default": 20
    },
    {
      "type": "header",
      "content": "Mobile Padding"
    },
    {
      "type": "range",
      "id": "mobile_padding_top",
      "label": "Top Padding",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "default": 30
    },
    {
      "type": "range",
      "id": "mobile_padding_right",
      "label": "Right Padding",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "default": 15
    },
    {
      "type": "range",
      "id": "mobile_padding_bottom",
      "label": "Bottom Padding",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "default": 30
    },
    {
      "type": "range",
      "id": "mobile_padding_left",
      "label": "Left Padding",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "default": 15
    }
  ],
  "blocks": [
    {
      "type": "look",
      "name": "Look Book Item",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Look Book Image"
        },
        {
          "type": "header",
          "content": "Hotspot 1"
        },
        {
          "type": "range",
          "id": "hotspot_1_x",
          "label": "X Position",
          "min": 0,
          "max": 100,
          "step": 1,
          "unit": "%",
          "default": 20
        },
        {
          "type": "range",
          "id": "hotspot_1_y",
          "label": "Y Position",
          "min": 0,
          "max": 100,
          "step": 1,
          "unit": "%",
          "default": 30
        },
        {
          "type": "product",
          "id": "hotspot_1_product",
          "label": "Product"
        },
        {
          "type": "header",
          "content": "Hotspot 2"
        },
        {
          "type": "range",
          "id": "hotspot_2_x",
          "label": "X Position",
          "min": 0,
          "max": 100,
          "step": 1,
          "unit": "%",
          "default": 50
        },
        {
          "type": "range",
          "id": "hotspot_2_y",
          "label": "Y Position",
          "min": 0,
          "max": 100,
          "step": 1,
          "unit": "%",
          "default": 60
        },
        {
          "type": "product",
          "id": "hotspot_2_product",
          "label": "Product"
        },
        {
          "type": "header",
          "content": "Hotspot 3"
        },
        {
          "type": "range",
          "id": "hotspot_3_x",
          "label": "X Position",
          "min": 0,
          "max": 100,
          "step": 1,
          "unit": "%",
          "default": 80
        },
        {
          "type": "range",
          "id": "hotspot_3_y",
          "label": "Y Position",
          "min": 0,
          "max": 100,
          "step": 1,
          "unit": "%",
          "default": 40
        },
        {
          "type": "product",
          "id": "hotspot_3_product",
          "label": "Product"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "PWC - Lookbook #1",
      "category": "Custom"
    }
  ]
}
{% endschema %}
