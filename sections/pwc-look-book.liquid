{%- assign sec_id = '#shopify-section-' | append: section.id -%}
{%- assign parts = sec_id | split: '_' -%}
{%- assign last_lower = parts | last -%}
{%- assign last_part = last_lower | downcase -%}

{% style %}
   {{ sec_id }} .pc-lookbook-{{ last_part }} {
     padding: {{ section.settings.desktop_padding_top }}px {{ section.settings.desktop_padding_right }}px {{ section.settings.desktop_padding_bottom }}px {{ section.settings.desktop_padding_left }}px !important;
     max-width: 1400px !important;
     margin: 0 auto !important;
     position: relative !important;
     box-sizing: border-box !important;
     width: 100% !important;
   }

   {{ sec_id }} .pc-lookbook-slider-container-{{ last_part }} {
     position: relative !important;
     width: 100% !important;
     overflow: hidden !important;
   }

   {{ sec_id }} .pc-lookbook-slider-{{ last_part }} {
     display: flex !important;
     overflow: hidden !important;
     scroll-behavior: smooth !important;
     -webkit-overflow-scrolling: touch !important;
     margin-bottom: 30px !important;
     width: 100% !important;
     position: relative !important;
   }

   {{ sec_id }} .pc-lookbook-item-{{ last_part }} {
     flex: 0 0 100% !important;
     display: flex !important;
     min-height: 500px !important;
     scroll-snap-align: start !important;
     width: 100% !important;
     position: relative !important;
   }

   {{ sec_id }} .pc-slider-arrows-{{ last_part }} {
     display: flex !important;
     justify-content: space-between !important;
     position: absolute !important;
     top: 50% !important;
     left: 0 !important;
     right: 0 !important;
     transform: translateY(-50%) !important;
     z-index: 100 !important;
     pointer-events: none !important;
   }

   {{ sec_id }} .pc-slider-arrow-{{ last_part }} {
     pointer-events: all !important;
     background: rgba(255, 255, 255, 0.8) !important;
     border: none !important;
     width: 40px !important;
     height: 40px !important;
     border-radius: 50% !important;
     display: flex !important;
     align-items: center !important;
     justify-content: center !important;
     cursor: pointer !important;
     transition: all 0.3s ease !important;
     box-shadow: 0 2px 5px rgba(0,0,0,0.1) !important;
   }

   {{ sec_id }} .pc-slider-arrow-{{ last_part }}:hover {
     background: #000 !important;
   }

   {{ sec_id }} .pc-slider-arrow-{{ last_part }}:hover svg {
     stroke: #fff !important;
   }

   {{ sec_id }} .pc-slider-arrow-{{ last_part }} svg {
     width: 20px !important;
     height: 20px !important;
     stroke: #000 !important;
     stroke-width: 2 !important;
   }

   {{ sec_id }} .pc-slider-arrow-prev-{{ last_part }} {
     margin-left: 20px !important;
   }

   {{ sec_id }} .pc-slider-arrow-next-{{ last_part }} {
     margin-right: 20px !important;
   }

   {{ sec_id }} .pc-lookbook-image-container-{{ last_part }} {
     flex: 0 0 50% !important;
     padding-right: 15px !important;
     position: relative !important;
     width: 50% !important;
     height: 100% !important;
   }

   {{ sec_id }} .pc-lookbook-products-{{ last_part }} {
     flex: 0 0 50% !important;
     padding-left: 15px !important;
     display: flex !important;
     align-items: center !important;
     width: 50% !important;
     height: 100% !important;
   }

   {{ sec_id }} .pc-lookbook-image-{{ last_part }} {
     position: relative !important;
     height: 100% !important;
     width: 100% !important;
   }

   {{ sec_id }} .pc-lookbook-image-{{ last_part }} img {
     width: 100% !important;
     height: 100% !important;
     object-fit: cover !important;
     display: block !important;
   }

   {{ sec_id }} .pc-product-slider-container-{{ last_part }} {
     height: 100% !important;
     position: relative !important;
     width: 100% !important;
   }

   {{ sec_id }} .pc-product-slider-{{ last_part }} {
     display: flex !important;
     overflow: hidden !important;
     scroll-behavior: smooth !important;
     height: 100% !important;
     width: 100% !important;
   }

   {{ sec_id }} .pc-product-slide-{{ last_part }} {
     flex: 0 0 100% !important;
     padding: 20px !important;
     transition: opacity 0.3s ease !important;
     display: flex !important;
     justify-content: center !important;
     align-items: center !important;
     min-width: 100% !important;
   }

   {{ sec_id }} .pc-product-card-{{ last_part }} {
     max-width: 100% !important;
     width: 100% !important;
     margin: 0 auto !important;
     text-align: center !important;
     padding: 20px !important;
   }

   {{ sec_id }} .pc-product-card-image-{{ last_part }} {
     max-width: 100% !important;
     margin: 0 auto !important;
     padding: 0 20px !important;
   }

   {{ sec_id }} .pc-product-card-info-{{ last_part }} {
     padding: 15px 0 !important;
     width: 100% !important;
   }

   {{ sec_id }} .pc-hotspot-{{ last_part }} {
     position: absolute !important;
     transform: translate(-50%, -50%) !important;
     cursor: pointer !important;
     z-index: 101 !important;
   }

   {{ sec_id }} .pc-hotspot-marker-{{ last_part }} {
     width: 24px !important;
     height: 24px !important;
     background: rgba(255, 255, 255, 0.8) !important;
     border: 2px solid #000 !important;
     border-radius: 50% !important;
     position: relative !important;
     transition: all 0.3s ease !important;
     display: flex !important;
     align-items: center !important;
     justify-content: center !important;
   }

   {{ sec_id }} .pc-hotspot-marker-{{ last_part }}:after {
     content: '' !important;
     width: 12px !important;
     height: 12px !important;
     background: #000 !important;
     border-radius: 50% !important;
   }

   {{ sec_id }} .pc-hotspot-{{ last_part }}.active .pc-hotspot-marker-{{ last_part }},
   {{ sec_id }} .pc-hotspot-{{ last_part }}:hover .pc-hotspot-marker-{{ last_part }} {
     transform: scale(1.3) !important;
     background: #000 !important;
   }

   {{ sec_id }} .pc-hotspot-{{ last_part }}.active .pc-hotspot-marker-{{ last_part }}:after,
   {{ sec_id }} .pc-hotspot-{{ last_part }}:hover .pc-hotspot-marker-{{ last_part }}:after {
     background: #fff !important;
   }

   {{ sec_id }} .pc-slider-nav-{{ last_part }} {
     display: flex !important;
     justify-content: center !important;
     margin-top: 30px !important;
   }

   {{ sec_id }} .pc-slider-dot-{{ last_part }} {
     width: 12px !important;
     height: 12px !important;
     border-radius: 50% !important;
     background: #ddd !important;
     margin: 0 5px !important;
     cursor: pointer !important;
     transition: all 0.3s ease !important;
   }

   {{ sec_id }} .pc-slider-dot-{{ last_part }}.active {
     background: #000 !important;
     transform: scale(1.2) !important;
   }

   {{ sec_id }} .pc-lookbook-dots-{{ last_part }} {
     display: flex !important;
     justify-content: center !important;
     margin-top: 20px !important;
   }

   {{ sec_id }} .pc-section-title-{{ last_part }} {
     font-size: {{ section.settings.title_font_size }}px !important;
     color: {{ section.settings.title_color }} !important;
     text-align: {{ section.settings.title_alignment }} !important;
     margin-bottom: {{ section.settings.title_margin_bottom }}px !important;
     font-weight: {{ section.settings.title_font_weight }} !important;
     width: 100% !important;
   }

   @media (max-width: 768px) {
     {{ sec_id }} .pc-lookbook-{{ last_part }} {
       padding: {{ section.settings.mobile_padding_top }}px {{ section.settings.mobile_padding_right }}px {{ section.settings.mobile_padding_bottom }}px {{ section.settings.mobile_padding_left }}px !important;
     }
     
     {{ sec_id }} .pc-lookbook-item-{{ last_part }} {
       flex-direction: column !important;
       min-height: auto !important;
     }

     {{ sec_id }} .pc-lookbook-image-container-{{ last_part }},
     {{ sec_id }} .pc-lookbook-products-{{ last_part }} {
       flex: 0 0 100% !important;
       padding: 0 !important;
       width: 100% !important;
     }

     {{ sec_id }} .pc-lookbook-image-{{ last_part }} {
       height: 400px !important;
     }

     {{ sec_id }} .pc-lookbook-products-{{ last_part }} {
       margin-top: 30px !important;
       height: auto !important;
       min-height: 300px !important;
     }

     {{ sec_id }} .pc-slider-arrow-{{ last_part }} {
       width: 30px !important;
       height: 30px !important;
     }

     {{ sec_id }} .pc-slider-arrow-prev-{{ last_part }} {
       margin-left: 10px !important;
     }

     {{ sec_id }} .pc-slider-arrow-next-{{ last_part }} {
       margin-right: 10px !important;
     }

     {{ sec_id }} .pc-product-slide-{{ last_part }} {
       padding: 10px !important;
     }

     {{ sec_id }} .pc-section-title-{{ last_part }} {
       font-size: {{ section.settings.mobile_title_font_size }}px !important;
       margin-bottom: {{ section.settings.mobile_title_margin_bottom }}px !important;
     }
   }
{% endstyle %}

<div class="pc-lookbook-{{ last_part }}">
  <h2 class="pc-section-title-{{ last_part }}">{{ section.settings.title }}</h2>

  <div class="pc-lookbook-slider-container-{{ last_part }}">
    <div class="pc-slider-arrows-{{ last_part }}">
      <button class="pc-slider-arrow-{{ last_part }} pc-slider-arrow-prev-{{ last_part }}" aria-label="Previous look">
        <svg viewBox="0 0 24 24" fill="none">
          <path d="M15 18L9 12L15 6" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
      <button class="pc-slider-arrow-{{ last_part }} pc-slider-arrow-next-{{ last_part }}" aria-label="Next look">
        <svg viewBox="0 0 24 24" fill="none">
          <path d="M9 6L15 12L9 18" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </div>

    <div class="pc-lookbook-slider-{{ last_part }}">
      {% for block in section.blocks %}
        <div
          class="pc-lookbook-item-{{ last_part }}"
          {{ block.shopify_attributes }}
          data-lookbook-index="{{ forloop.index0 }}"
        >
          <div class="pc-lookbook-image-container-{{ last_part }}">
            {% if block.settings.image != blank %}
              <div class="pc-lookbook-image-{{ last_part }}">
                {{
                  block.settings.image
                  | image_url: width: 1000
                  | image_tag: loading: 'lazy', alt: block.settings.image.alt, class: 'pc-lookbook-img'
                }}

                {% if block.settings.hotspot_1_product != blank %}
                  <div
                    class="pc-hotspot-{{ last_part }} {% if forloop.first %}active{% endif %}"
                    style="left: {{ block.settings.hotspot_1_x }}%; top: {{ block.settings.hotspot_1_y }}%;"
                    data-product-id="{{ all_products[block.settings.hotspot_1_product].variants.first.id }}"
                    data-slide-index="0"
                  >
                    <div class="pc-hotspot-marker-{{ last_part }}"></div>
                  </div>
                {% endif %}

                {% if block.settings.hotspot_2_product != blank %}
                  <div
                    class="pc-hotspot-{{ last_part }}"
                    style="left: {{ block.settings.hotspot_2_x }}%; top: {{ block.settings.hotspot_2_y }}%;"
                    data-product-id="{{ all_products[block.settings.hotspot_2_product].variants.first.id }}"
                    data-slide-index="1"
                  >
                    <div class="pc-hotspot-marker-{{ last_part }}"></div>
                  </div>
                {% endif %}

                {% if block.settings.hotspot_3_product != blank %}
                  <div
                    class="pc-hotspot-{{ last_part }}"
                    style="left: {{ block.settings.hotspot_3_x }}%; top: {{ block.settings.hotspot_3_y }}%;"
                    data-product-id="{{ all_products[block.settings.hotspot_3_product].variants.first.id }}"
                    data-slide-index="2"
                  >
                    <div class="pc-hotspot-marker-{{ last_part }}"></div>
                  </div>
                {% endif %}
              </div>
            {% else %}
              <div class="pc-lookbook-image-{{ last_part }}">
                {{ 'product-1' | placeholder_svg_tag: 'pc-lookbook-placeholder' }}
              </div>
            {% endif %}
          </div>

          <div class="pc-lookbook-products-{{ last_part }}">
            <div class="pc-product-slider-container-{{ last_part }}">
              <div class="pc-product-slider-{{ last_part }}" id="pc-product-slider-{{ last_part }}-{{ forloop.index }}">
                {% if block.settings.hotspot_1_product != blank %}
                  {% assign product = all_products[block.settings.hotspot_1_product] %}
                  <div class="pc-product-slide-{{ last_part }}" data-product-id="{{ product.variants.first.id }}">
                    <div class="pc-product-card-{{ last_part }}">
                      <div class="pc-product-card-image-{{ last_part }}">
                        <a href="{{ product.url }}">
                          {{
                            product.featured_image
                            | image_url: width: 400
                            | image_tag: loading: 'lazy', alt: product.title, class: 'pc-product-img'
                          }}
                        </a>
                      </div>
                      <div class="pc-product-card-info-{{ last_part }}">
                        <h3>
                          <a href="{{ product.url }}">{{ product.title }}</a>
                        </h3>
                        <p>{{ product.price | money }}</p>
                      </div>
                    </div>
                  </div>
                {% endif %}

                {% if block.settings.hotspot_2_product != blank %}
                  {% assign product = all_products[block.settings.hotspot_2_product] %}
                  <div class="pc-product-slide-{{ last_part }}" data-product-id="{{ product.variants.first.id }}">
                    <div class="pc-product-card-{{ last_part }}">
                      <div class="pc-product-card-image-{{ last_part }}">
                        <a href="{{ product.url }}">
                          {{
                            product.featured_image
                            | image_url: width: 400
                            | image_tag: loading: 'lazy', alt: product.title, class: 'pc-product-img'
                          }}
                        </a>
                      </div>
                      <div class="pc-product-card-info-{{ last_part }}">
                        <h3>
                          <a href="{{ product.url }}">{{ product.title }}</a>
                        </h3>
                        <p>{{ product.price | money }}</p>
                      </div>
                    </div>
                  </div>
                {% endif %}

                {% if block.settings.hotspot_3_product != blank %}
                  {% assign product = all_products[block.settings.hotspot_3_product] %}
                  <div class="pc-product-slide-{{ last_part }}" data-product-id="{{ product.variants.first.id }}">
                    <div class="pc-product-card-{{ last_part }}">
                      <div class="pc-product-card-image-{{ last_part }}">
                        <a href="{{ product.url }}">
                          {{
                            product.featured_image
                            | image_url: width: 400
                            | image_tag: loading: 'lazy', alt: product.title, class: 'pc-product-img'
                          }}
                        </a>
                      </div>
                      <div class="pc-product-card-info-{{ last_part }}">
                        <h3>
                          <a href="{{ product.url }}">{{ product.title }}</a>
                        </h3>
                        <p>{{ product.price | money }}</p>
                      </div>
                    </div>
                  </div>
                {% endif %}
              </div>

              <div class="pc-slider-nav-{{ last_part }}">
                {% if block.settings.hotspot_1_product != blank %}
                  <div class="pc-slider-dot-{{ last_part }} active" data-slide-index="0"></div>
                {% endif %}
                {% if block.settings.hotspot_2_product != blank %}
                  <div class="pc-slider-dot-{{ last_part }}" data-slide-index="1"></div>
                {% endif %}
                {% if block.settings.hotspot_3_product != blank %}
                  <div class="pc-slider-dot-{{ last_part }}" data-slide-index="2"></div>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  </div>

  <div class="pc-lookbook-dots-{{ last_part }}">
    {% for block in section.blocks %}
      <div
        class="pc-slider-dot-{{ last_part }} {% if forloop.first %}active{% endif %}"
        data-lookbook-index="{{ forloop.index0 }}"
      ></div>
    {% endfor %}
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Use more specific selectors with the section ID
    const section = document.querySelector('{{ sec_id }}');
    if (!section) return;
    
    const lastPart = '{{ last_part }}';
    const lookbookSlider = section.querySelector(`.pc-lookbook-slider-${lastPart}`);
    const lookbookDots = section.querySelectorAll(`.pc-lookbook-dots-${lastPart} .pc-slider-dot-${lastPart}`);
    const lookbookItems = section.querySelectorAll(`.pc-lookbook-item-${lastPart}`);
    const prevArrow = section.querySelector(`.pc-slider-arrow-prev-${lastPart}`);
    const nextArrow = section.querySelector(`.pc-slider-arrow-next-${lastPart}`);

    // Only proceed if essential elements exist
    if (!lookbookSlider || !lookbookItems.length) return;

    let currentLookbookIndex = 0;
    let isScrolling = false;

    function updateLookbookSlider(index) {
      if (isScrolling) return;
      if (index < 0 || index >= lookbookItems.length) return;
      
      currentLookbookIndex = index;
      isScrolling = true;
      
      const itemWidth = lookbookItems[0].offsetWidth;
      lookbookSlider.scrollTo({
        left: itemWidth * index,
        behavior: 'smooth'
      });

      // Update dots
      lookbookDots.forEach(dot => {
        dot.classList.toggle('active', parseInt(dot.dataset.lookbookIndex) === index);
      });

      // Reset scrolling flag after animation
      setTimeout(() => {
        isScrolling = false;
      }, 500);
    }

    // Add event listeners with checks
    if (prevArrow) {
      prevArrow.addEventListener('click', function() {
        updateLookbookSlider(currentLookbookIndex - 1);
      });
    }

    if (nextArrow) {
      nextArrow.addEventListener('click', function() {
        updateLookbookSlider(currentLookbookIndex + 1);
      });
    }

    // Initialize each lookbook item
    lookbookItems.forEach((item, index) => {
      const slider = item.querySelector(`.pc-product-slider-${lastPart}`);
      const hotspots = item.querySelectorAll(`.pc-hotspot-${lastPart}`);
{%- assign sec_id = '#shopify-section-' | append: section.id -%}
{%- assign parts = sec_id | split: '_' -%}
{%- assign last_lower = parts | last -%}
{%- assign last_part = last_lower | downcase -%}

{% style %}
   {{ sec_id }} .pc-lookbook-{{ last_part }} {
     padding: {{ section.settings.desktop_padding_top }}px {{ section.settings.desktop_padding_right }}px {{ section.settings.desktop_padding_bottom }}px {{ section.settings.desktop_padding_left }}px !important;
     max-width: 1400px !important;
     margin: 0 auto !important;
     position: relative !important;
     box-sizing: border-box !important;
     width: 100% !important;
   }

   {{ sec_id }} .pc-lookbook-slider-container-{{ last_part }} {
     position: relative !important;
     width: 100% !important;
     overflow: hidden !important;
   }

   {{ sec_id }} .pc-lookbook-slider-{{ last_part }} {
     display: flex !important;
     overflow: hidden !important;
     scroll-behavior: smooth !important;
     -webkit-overflow-scrolling: touch !important;
     margin-bottom: 30px !important;
     width: 100% !important;
     position: relative !important;
   }

   {{ sec_id }} .pc-lookbook-item-{{ last_part }} {
     flex: 0 0 100% !important;
     display: flex !important;
     min-height: 500px !important;
     scroll-snap-align: start !important;
     width: 100% !important;
     position: relative !important;
   }

   {{ sec_id }} .pc-slider-arrows-{{ last_part }} {
     display: flex !important;
     justify-content: space-between !important;
     position: absolute !important;
     top: 50% !important;
     left: 0 !important;
     right: 0 !important;
     transform: translateY(-50%) !important;
     z-index: 100 !important;
     pointer-events: none !important;
   }

   {{ sec_id }} .pc-slider-arrow-{{ last_part }} {
     pointer-events: all !important;
     background: rgba(255, 255, 255, 0.8) !important;
     border: none !important;
     width: 40px !important;
     height: 40px !important;
     border-radius: 50% !important;
     display: flex !important;
     align-items: center !important;
     justify-content: center !important;
     cursor: pointer !important;
     transition: all 0.3s ease !important;
     box-shadow: 0 2px 5px rgba(0,0,0,0.1) !important;
   }

   {{ sec_id }} .pc-slider-arrow-{{ last_part }}:hover {
     background: #000 !important;
   }

   {{ sec_id }} .pc-slider-arrow-{{ last_part }}:hover svg {
     stroke: #fff !important;
   }

   {{ sec_id }} .pc-slider-arrow-{{ last_part }} svg {
     width: 20px !important;
     height: 20px !important;
     stroke: #000 !important;
     stroke-width: 2 !important;
   }

   {{ sec_id }} .pc-slider-arrow-prev-{{ last_part }} {
     margin-left: 20px !important;
   }

   {{ sec_id }} .pc-slider-arrow-next-{{ last_part }} {
     margin-right: 20px !important;
   }

   {{ sec_id }} .pc-lookbook-image-container-{{ last_part }} {
     flex: 0 0 50% !important;
     padding-right: 15px !important;
     position: relative !important;
     width: 50% !important;
     height: 100% !important;
   }

   {{ sec_id }} .pc-lookbook-products-{{ last_part }} {
     flex: 0 0 50% !important;
     padding-left: 15px !important;
     display: flex !important;
     align-items: center !important;
     width: 50% !important;
     height: 100% !important;
   }

   {{ sec_id }} .pc-lookbook-image-{{ last_part }} {
     position: relative !important;
     height: 100% !important;
     width: 100% !important;
   }

   {{ sec_id }} .pc-lookbook-image-{{ last_part }} img {
     width: 100% !important;
     height: 100% !important;
     object-fit: cover !important;
     display: block !important;
   }

   {{ sec_id }} .pc-product-slider-container-{{ last_part }} {
     height: 100% !important;
     position: relative !important;
     width: 100% !important;
   }

   {{ sec_id }} .pc-product-slider-{{ last_part }} {
     display: flex !important;
     overflow: hidden !important;
     scroll-behavior: smooth !important;
     height: 100% !important;
     width: 100% !important;
   }

   {{ sec_id }} .pc-product-slide-{{ last_part }} {
     flex: 0 0 100% !important;
     padding: 20px !important;
     transition: opacity 0.3s ease !important;
     display: flex !important;
     justify-content: center !important;
     align-items: center !important;
     min-width: 100% !important;
   }

   {{ sec_id }} .pc-product-card-{{ last_part }} {
     max-width: 100% !important;
     width: 100% !important;
     margin: 0 auto !important;
     text-align: center !important;
     padding: 20px !important;
   }

   {{ sec_id }} .pc-product-card-image-{{ last_part }} {
     max-width: 100% !important;
     margin: 0 auto !important;
     padding: 0 20px !important;
   }

   {{ sec_id }} .pc-product-card-info-{{ last_part }} {
     padding: 15px 0 !important;
     width: 100% !important;
   }

   {{ sec_id }} .pc-hotspot-{{ last_part }} {
     position: absolute !important;
     transform: translate(-50%, -50%) !important;
     cursor: pointer !important;
     z-index: 101 !important;
   }

   {{ sec_id }} .pc-hotspot-marker-{{ last_part }} {
     width: 24px !important;
     height: 24px !important;
     background: rgba(255, 255, 255, 0.8) !important;
     border: 2px solid #000 !important;
     border-radius: 50% !important;
     position: relative !important;
     transition: all 0.3s ease !important;
     display: flex !important;
     align-items: center !important;
     justify-content: center !important;
   }

   {{ sec_id }} .pc-hotspot-marker-{{ last_part }}:after {
     content: '' !important;
     width: 12px !important;
     height: 12px !important;
     background: #000 !important;
     border-radius: 50% !important;
   }

   {{ sec_id }} .pc-hotspot-{{ last_part }}.active .pc-hotspot-marker-{{ last_part }},
   {{ sec_id }} .pc-hotspot-{{ last_part }}:hover .pc-hotspot-marker-{{ last_part }} {
     transform: scale(1.3) !important;
     background: #000 !important;
   }

   {{ sec_id }} .pc-hotspot-{{ last_part }}.active .pc-hotspot-marker-{{ last_part }}:after,
   {{ sec_id }} .pc-hotspot-{{ last_part }}:hover .pc-hotspot-marker-{{ last_part }}:after {
     background: #fff !important;
   }

   {{ sec_id }} .pc-slider-nav-{{ last_part }} {
     display: flex !important;
     justify-content: center !important;
     margin-top: 30px !important;
   }

   {{ sec_id }} .pc-slider-dot-{{ last_part }} {
     width: 12px !important;
     height: 12px !important;
     border-radius: 50% !important;
     background: #ddd !important;
     margin: 0 5px !important;
     cursor: pointer !important;
     transition: all 0.3s ease !important;
   }

   {{ sec_id }} .pc-slider-dot-{{ last_part }}.active {
     background: #000 !important;
     transform: scale(1.2) !important;
   }

   {{ sec_id }} .pc-lookbook-dots-{{ last_part }} {
     display: flex !important;
     justify-content: center !important;
     margin-top: 20px !important;
   }

   {{ sec_id }} .pc-section-title-{{ last_part }} {
     font-size: {{ section.settings.title_font_size }}px !important;
     color: {{ section.settings.title_color }} !important;
     text-align: {{ section.settings.title_alignment }} !important;
     margin-bottom: {{ section.settings.title_margin_bottom }}px !important;
     font-weight: {{ section.settings.title_font_weight }} !important;
     width: 100% !important;
   }

   @media (max-width: 768px) {
     {{ sec_id }} .pc-lookbook-{{ last_part }} {
       padding: {{ section.settings.mobile_padding_top }}px {{ section.settings.mobile_padding_right }}px {{ section.settings.mobile_padding_bottom }}px {{ section.settings.mobile_padding_left }}px !important;
     }
     
     {{ sec_id }} .pc-lookbook-item-{{ last_part }} {
       flex-direction: column !important;
       min-height: auto !important;
     }

     {{ sec_id }} .pc-lookbook-image-container-{{ last_part }},
     {{ sec_id }} .pc-lookbook-products-{{ last_part }} {
       flex: 0 0 100% !important;
       padding: 0 !important;
       width: 100% !important;
     }

     {{ sec_id }} .pc-lookbook-image-{{ last_part }} {
       height: 400px !important;
     }

     {{ sec_id }} .pc-lookbook-products-{{ last_part }} {
       margin-top: 30px !important;
       height: auto !important;
       min-height: 300px !important;
     }

     {{ sec_id }} .pc-slider-arrow-{{ last_part }} {
       width: 30px !important;
       height: 30px !important;
     }

     {{ sec_id }} .pc-slider-arrow-prev-{{ last_part }} {
       margin-left: 10px !important;
     }

     {{ sec_id }} .pc-slider-arrow-next-{{ last_part }} {
       margin-right: 10px !important;
     }

     {{ sec_id }} .pc-product-slide-{{ last_part }} {
       padding: 10px !important;
     }

     {{ sec_id }} .pc-section-title-{{ last_part }} {
       font-size: {{ section.settings.mobile_title_font_size }}px !important;
       margin-bottom: {{ section.settings.mobile_title_margin_bottom }}px !important;
     }
   }
{% endstyle %}

<div class="pc-lookbook-{{ last_part }}">
  <h2 class="pc-section-title-{{ last_part }}">{{ section.settings.title }}</h2>

  <div class="pc-lookbook-slider-container-{{ last_part }}">
    <div class="pc-slider-arrows-{{ last_part }}">
      <button class="pc-slider-arrow-{{ last_part }} pc-slider-arrow-prev-{{ last_part }}" aria-label="Previous look">
        <svg viewBox="0 0 24 24" fill="none">
          <path d="M15 18L9 12L15 6" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
      <button class="pc-slider-arrow-{{ last_part }} pc-slider-arrow-next-{{ last_part }}" aria-label="Next look">
        <svg viewBox="0 0 24 24" fill="none">
          <path d="M9 6L15 12L9 18" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </div>

    <div class="pc-lookbook-slider-{{ last_part }}">
      {% for block in section.blocks %}
        <div
          class="pc-lookbook-item-{{ last_part }}"
          {{ block.shopify_attributes }}
          data-lookbook-index="{{ forloop.index0 }}"
        >
          <div class="pc-lookbook-image-container-{{ last_part }}">
            {% if block.settings.image != blank %}
              <div class="pc-lookbook-image-{{ last_part }}">
                {{
                  block.settings.image
                  | image_url: width: 1000
                  | image_tag: loading: 'lazy', alt: block.settings.image.alt, class: 'pc-lookbook-img'
                }}

                {% if block.settings.hotspot_1_product != blank %}
                  <div
                    class="pc-hotspot-{{ last_part }} {% if forloop.first %}active{% endif %}"
                    style="left: {{ block.settings.hotspot_1_x }}%; top: {{ block.settings.hotspot_1_y }}%;"
                    data-product-id="{{ all_products[block.settings.hotspot_1_product].variants.first.id }}"
                    data-slide-index="0"
                  >
                    <div class="pc-hotspot-marker-{{ last_part }}"></div>
                  </div>
                {% endif %}

                {% if block.settings.hotspot_2_product != blank %}
                  <div
                    class="pc-hotspot-{{ last_part }}"
                    style="left: {{ block.settings.hotspot_2_x }}%; top: {{ block.settings.hotspot_2_y }}%;"
                    data-product-id="{{ all_products[block.settings.hotspot_2_product].variants.first.id }}"
                    data-slide-index="1"
                  >
                    <div class="pc-hotspot-marker-{{ last_part }}"></div>
                  </div>
                {% endif %}

                {% if block.settings.hotspot_3_product != blank %}
                  <div
                    class="pc-hotspot-{{ last_part }}"
                    style="left: {{ block.settings.hotspot_3_x }}%; top: {{ block.settings.hotspot_3_y }}%;"
                    data-product-id="{{ all_products[block.settings.hotspot_3_product].variants.first.id }}"
                    data-slide-index="2"
                  >
                    <div class="pc-hotspot-marker-{{ last_part }}"></div>
                  </div>
                {% endif %}
              </div>
            {% else %}
              <div class="pc-lookbook-image-{{ last_part }}">
                {{ 'product-1' | placeholder_svg_tag: 'pc-lookbook-placeholder' }}
              </div>
            {% endif %}
          </div>

          <div class="pc-lookbook-products-{{ last_part }}">
            <div class="pc-product-slider-container-{{ last_part }}">
              <div class="pc-product-slider-{{ last_part }}" id="pc-product-slider-{{ last_part }}-{{ forloop.index }}">
                {% if block.settings.hotspot_1_product != blank %}
                  {% assign product = all_products[block.settings.hotspot_1_product] %}
                  <div class="pc-product-slide-{{ last_part }}" data-product-id="{{ product.variants.first.id }}">
                    <div class="pc-product-card-{{ last_part }}">
                      <div class="pc-product-card-image-{{ last_part }}">
                        <a href="{{ product.url }}">
                          {{
                            product.featured_image
                            | image_url: width: 400
                            | image_tag: loading: 'lazy', alt: product.title, class: 'pc-product-img'
                          }}
                        </a>
                      </div>
                      <div class="pc-product-card-info-{{ last_part }}">
                        <h3>
                          <a href="{{ product.url }}">{{ product.title }}</a>
                        </h3>
                        <p>{{ product.price | money }}</p>
                      </div>
                    </div>
                  </div>
                {% endif %}

                {% if block.settings.hotspot_2_product != blank %}
                  {% assign product = all_products[block.settings.hotspot_2_product] %}
                  <div class="pc-product-slide-{{ last_part }}" data-product-id="{{ product.variants.first.id }}">
                    <div class="pc-product-card-{{ last_part }}">
                      <div class="pc-product-card-image-{{ last_part }}">
                        <a href="{{ product.url }}">
                          {{
                            product.featured_image
                            | image_url: width: 400
                            | image_tag: loading: 'lazy', alt: product.title, class: 'pc-product-img'
                          }}
                        </a>
                      </div>
                      <div class="pc-product-card-info-{{ last_part }}">
                        <h3>
                          <a href="{{ product.url }}">{{ product.title }}</a>
                        </h3>
                        <p>{{ product.price | money }}</p>
                      </div>
                    </div>
                  </div>
                {% endif %}

                {% if block.settings.hotspot_3_product != blank %}
                  {% assign product = all_products[block.settings.hotspot_3_product] %}
                  <div class="pc-product-slide-{{ last_part }}" data-product-id="{{ product.variants.first.id }}">
                    <div class="pc-product-card-{{ last_part }}">
                      <div class="pc-product-card-image-{{ last_part }}">
                        <a href="{{ product.url }}">
                          {{
                            product.featured_image
                            | image_url: width: 400
                            | image_tag: loading: 'lazy', alt: product.title, class: 'pc-product-img'
                          }}
                        </a>
                      </div>
                      <div class="pc-product-card-info-{{ last_part }}">
                        <h3>
                          <a href="{{ product.url }}">{{ product.title }}</a>
                        </h3>
                        <p>{{ product.price | money }}</p>
                      </div>
                    </div>
                  </div>
                {% endif %}
              </div>

              <div class="pc-slider-nav-{{ last_part }}">
                {% if block.settings.hotspot_1_product != blank %}
                  <div class="pc-slider-dot-{{ last_part }} active" data-slide-index="0"></div>
                {% endif %}
                {% if block.settings.hotspot_2_product != blank %}
                  <div class="pc-slider-dot-{{ last_part }}" data-slide-index="1"></div>
                {% endif %}
                {% if block.settings.hotspot_3_product != blank %}
                  <div class="pc-slider-dot-{{ last_part }}" data-slide-index="2"></div>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  </div>

  <div class="pc-lookbook-dots-{{ last_part }}">
    {% for block in section.blocks %}
      <div
        class="pc-slider-dot-{{ last_part }} {% if forloop.first %}active{% endif %}"
        data-lookbook-index="{{ forloop.index0 }}"
      ></div>
    {% endfor %}
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Use more specific selectors with the section ID
    const section = document.querySelector('{{ sec_id }}');
    if (!section) return;
    
    const lastPart = '{{ last_part }}';
    const lookbookSlider = section.querySelector(`.pc-lookbook-slider-${lastPart}`);
    const lookbookDots = section.querySelectorAll(`.pc-lookbook-dots-${lastPart} .pc-slider-dot-${lastPart}`);
    const lookbookItems = section.querySelectorAll(`.pc-lookbook-item-${lastPart}`);
    const prevArrow = section.querySelector(`.pc-slider-arrow-prev-${lastPart}`);
    const nextArrow = section.querySelector(`.pc-slider-arrow-next-${lastPart}`);

    // Only proceed if essential elements exist
    if (!lookbookSlider || !lookbookItems.length) return;

    let currentLookbookIndex = 0;
    let isScrolling = false;

    function updateLookbookSlider(index) {
      if (isScrolling) return;
      if (index < 0 || index >= lookbookItems.length) return;
      
      currentLookbookIndex = index;
      isScrolling = true;
      
      const itemWidth = lookbookItems[0].offsetWidth;
      lookbookSlider.scrollTo({
        left: itemWidth * index,
        behavior: 'smooth'
      });

      // Update dots
      lookbookDots.forEach(dot => {
        dot.classList.toggle('active', parseInt(dot.dataset.lookbookIndex) === index);
      });

      // Reset scrolling flag after animation
      setTimeout(() => {
        isScrolling = false;
      }, 500);
    }

    // Add event listeners with checks
    if (prevArrow) {
      prevArrow.addEventListener('click', function() {
        updateLookbookSlider(currentLookbookIndex - 1);
      });
    }

    if (nextArrow) {
      nextArrow.addEventListener('click', function() {
        updateLookbookSlider(currentLookbookIndex + 1);
      });
    }

    // Initialize each lookbook item
    lookbookItems.forEach((item, index) => {
      const slider = item.querySelector(`.pc-product-slider-${lastPart}`);
      const hotspots = item.querySelectorAll(`.pc-hotspot-${lastPart}`);
      const dots = item.querySelectorAll(`.pc-slider-nav-${lastPart} .pc-slider-dot-${lastPart}`);
      
      if (!slider || !hotspots.length || !dots.length) return;

      let isProductScrolling = false;

      function goToProductSlide(slideIndex) {
        if (isProductScrolling) return;
        if (slideIndex < 0 || slideIndex >= hotspots.length) return;
        
        isProductScrolling = true;
        
        slider.scrollTo({
          left: slider.offsetWidth * slideIndex,
          behavior: 'smooth'
        });

        hotspots.forEach(hotspot => {
          hotspot.classList.toggle('active', parseInt(hotspot.dataset.slideIndex) === slideIndex);
        });

        dots.forEach(dot => {
          dot.classList.toggle('active', parseInt(dot.dataset.slideIndex) === slideIndex);
        });

        setTimeout(() => {
          isProductScrolling = false;
        }, 500);
      }

      // Add click handlers
      hotspots.forEach(hotspot => {
        hotspot.addEventListener('click', function() {
          goToProductSlide(parseInt(this.dataset.slideIndex));
        });
      });

      dots.forEach(dot => {
        dot.addEventListener('click', function() {
          goToProductSlide(parseInt(this.dataset.slideIndex));
        });
      });

      // Initialize first slide as active
      if (hotspots.length > 0) {
        const firstHotspot = item.querySelector(`.pc-hotspot-${lastPart}`);
        if (firstHotspot) {
          firstHotspot.classList.add('active');
        }
      }
    });

    // Handle scroll events for lookbook slider
    let lookbookScrollTimeout;
    lookbookSlider.addEventListener('scroll', function() {
      clearTimeout(lookbookScrollTimeout);
      lookbookScrollTimeout = setTimeout(() => {
        if (isScrolling) return;
        
        const scrollPosition = lookbookSlider.scrollLeft;
        const itemWidth = lookbookItems[0].offsetWidth;
        const newIndex = Math.round(scrollPosition / itemWidth);
        
        if (newIndex !== currentLookbookIndex) {
          currentLookbookIndex = newIndex;
          lookbookDots.forEach(dot => {
            dot.classList.toggle('active', parseInt(dot.dataset.lookbookIndex) === currentLookbookIndex);
          });
        }
      }, 100);
    });

    // Handle dot navigation clicks
    lookbookDots.forEach(dot => {
      dot.addEventListener('click', function() {
        const lookbookIndex = parseInt(this.dataset.lookbookIndex);
        updateLookbookSlider(lookbookIndex);
      });
    });

    // Initialize first lookbook item as active
    if (lookbookDots.length > 0) {
      lookbookDots[0].classList.add('active');
    }
  });
</script>

{% schema %}
{
  "name": "PWC - Lookbook #1",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Section Title",
      "default": "Look Book"
    },
    {
      "type": "header",
      "content": "Title Styling"
    },
    {
      "type": "range",
      "id": "title_font_size",
      "label": "Font Size (Desktop)",
      "min": 12,
      "max": 72,
      "step": 1,
      "unit": "px",
      "default": 32
    },
    {
      "type": "range",
      "id": "mobile_title_font_size",
      "label": "Font Size (Mobile)",
      "min": 12,
      "max": 48,
      "step": 1,
      "unit": "px",
      "default": 24
    },
    {
      "type": "color",
      "id": "title_color",
      "label": "Title Color",
      "default": "#000000"
    },
    {
      "type": "select",
      "id": "title_alignment",
      "label": "Title Alignment",
      "options": [
        {
          "value": "left",
          "label": "Left"
        },
        {
          "value": "center",
          "label": "Center"
        },
        {
          "value": "right",
          "label": "Right"
        }
      ],
      "default": "center"
    },
    {
      "type": "range",
      "id": "title_font_weight",
      "label": "Font Weight",
      "min": 300,
      "max": 900,
      "step": 100,
      "default": 600
    },
    {
      "type": "range",
      "id": "title_margin_bottom",
      "label": "Title Margin Bottom (Desktop)",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "default": 30
    },
    {
      "type": "range",
      "id": "mobile_title_margin_bottom",
      "label": "Title Margin Bottom (Mobile)",
      "min": 0,
      "max": 60,
      "step": 5,
      "unit": "px",
      "default": 20
    },
    {
      "type": "header",
      "content": "Desktop Padding"
    },
    {
      "type": "range",
      "id": "desktop_padding_top",
      "label": "Top Padding",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "default": 50
    },
    {
      "type": "range",
      "id": "desktop_padding_right",
      "label": "Right Padding",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "default": 20
    },
    {
      "type": "range",
      "id": "desktop_padding_bottom",
      "label": "Bottom Padding",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "default": 50
    },
    {
      "type": "range",
      "id": "desktop_padding_left",
      "label": "Left Padding",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "default": 20
    },
    {
      "type": "header",
      "content": "Mobile Padding"
    },
    {
      "type": "range",
      "id": "mobile_padding_top",
      "label": "Top Padding",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "default": 30
    },
    {
      "type": "range",
      "id": "mobile_padding_right",
      "label": "Right Padding",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "default": 15
    },
    {
      "type": "range",
      "id": "mobile_padding_bottom",
      "label": "Bottom Padding",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "default": 30
    },
    {
      "type": "range",
      "id": "mobile_padding_left",
      "label": "Left Padding",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "default": 15
    }
  ],
  "blocks": [
    {
      "type": "look",
      "name": "Look Book Item",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Look Book Image"
        },
        {
          "type": "header",
          "content": "Hotspot 1"
        },
        {
          "type": "range",
          "id": "hotspot_1_x",
          "label": "X Position",
          "min": 0,
          "max": 100,
          "step": 1,
          "unit": "%",
          "default": 20
        },
        {
          "type": "range",
          "id": "hotspot_1_y",
          "label": "Y Position",
          "min": 0,
          "max": 100,
          "step": 1,
          "unit": "%",
          "default": 30
        },
        {
          "type": "product",
          "id": "hotspot_1_product",
          "label": "Product"
        },
        {
          "type": "header",
          "content": "Hotspot 2"
        },
        {
          "type": "range",
          "id": "hotspot_2_x",
          "label": "X Position",
          "min": 0,
          "max": 100,
          "step": 1,
          "unit": "%",
          "default": 50
        },
        {
          "type": "range",
          "id": "hotspot_2_y",
          "label": "Y Position",
          "min": 0,
          "max": 100,
          "step": 1,
          "unit": "%",
          "default": 60
        },
        {
          "type": "product",
          "id": "hotspot_2_product",
          "label": "Product"
        },
        {
          "type": "header",
          "content": "Hotspot 3"
        },
        {
          "type": "range",
          "id": "hotspot_3_x",
          "label": "X Position",
          "min": 0,
          "max": 100,
          "step": 1,
          "unit": "%",
          "default": 80
        },
        {
          "type": "range",
          "id": "hotspot_3_y",
          "label": "Y Position",
          "min": 0,
          "max": 100,
          "step": 1,
          "unit": "%",
          "default": 40
        },
        {
          "type": "product",
          "id": "hotspot_3_product",
          "label": "Product"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "PWC - Lookbook #1",
      "category": "Custom"
    }
  ]
}
{% endschema %}
